"use strict";var y=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var a=(o,t)=>y(o,"name",{value:t,configurable:!0});var N=(o,t)=>{for(var e in t)y(o,e,{get:t[e],enumerable:!0})},q=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of R(t))!w.call(o,i)&&i!==e&&y(o,i,{get:()=>t[i],enumerable:!(n=k(t,i))||n.enumerable});return o};var O=o=>q(y({},"__esModule",{value:!0}),o);var M={};N(M,{handler:()=>x});module.exports=O(M);var C=require("@aws-sdk/client-macie2");function h(o){let t=o;return(t!==null&&typeof t=="object"||typeof t=="function")&&(typeof t.allowListIds>"u"||Array.isArray(t.allowListIds)&&t.allowListIds.every(e=>typeof e=="string"))&&(typeof t.clientToken>"u"||typeof t.clientToken=="string")&&(typeof t.customDataIdentifierIds>"u"||Array.isArray(t.customDataIdentifierIds)&&t.customDataIdentifierIds.every(e=>typeof e=="string"))&&(typeof t.description>"u"||typeof t.description=="string")&&(typeof t.initialRun>"u"||t.initialRun===!1||t.initialRun===!0)&&(typeof t.jobType>"u"||t.jobType==="ONE_TIME"||t.jobType==="SCHEDULED")&&(typeof t.managedDataIdentifierIds>"u"||Array.isArray(t.managedDataIdentifierIds)&&t.managedDataIdentifierIds.every(e=>typeof e=="string"))&&(typeof t.managedDataIdentifierSelector>"u"||t.managedDataIdentifierSelector==="ALL"||t.managedDataIdentifierSelector==="EXCLUDE"||t.managedDataIdentifierSelector==="INCLUDE"||t.managedDataIdentifierSelector==="NONE"||t.managedDataIdentifierSelector==="RECOMMENDED")&&(typeof t.name>"u"||typeof t.name=="string")&&(typeof t.s3JobDefinition>"u"||(t.s3JobDefinition!==null&&typeof t.s3JobDefinition=="object"||typeof t.s3JobDefinition=="function")&&(typeof t.s3JobDefinition.bucketCriteria>"u"||(t.s3JobDefinition.bucketCriteria!==null&&typeof t.s3JobDefinition.bucketCriteria=="object"||typeof t.s3JobDefinition.bucketCriteria=="function")&&(typeof t.s3JobDefinition.bucketCriteria.excludes>"u"||(t.s3JobDefinition.bucketCriteria.excludes!==null&&typeof t.s3JobDefinition.bucketCriteria.excludes=="object"||typeof t.s3JobDefinition.bucketCriteria.excludes=="function")&&(typeof t.s3JobDefinition.bucketCriteria.excludes.and>"u"||Array.isArray(t.s3JobDefinition.bucketCriteria.excludes.and)&&t.s3JobDefinition.bucketCriteria.excludes.and.every(e=>(e!==null&&typeof e=="object"||typeof e=="function")&&(typeof e.simpleCriterion>"u"||(e.simpleCriterion!==null&&typeof e.simpleCriterion=="object"||typeof e.simpleCriterion=="function")&&(typeof e.simpleCriterion.comparator>"u"||e.simpleCriterion.comparator==="CONTAINS"||e.simpleCriterion.comparator==="EQ"||e.simpleCriterion.comparator==="GT"||e.simpleCriterion.comparator==="GTE"||e.simpleCriterion.comparator==="LT"||e.simpleCriterion.comparator==="LTE"||e.simpleCriterion.comparator==="NE"||e.simpleCriterion.comparator==="STARTS_WITH")&&(typeof e.simpleCriterion.key>"u"||e.simpleCriterion.key==="ACCOUNT_ID"||e.simpleCriterion.key==="S3_BUCKET_EFFECTIVE_PERMISSION"||e.simpleCriterion.key==="S3_BUCKET_NAME"||e.simpleCriterion.key==="S3_BUCKET_SHARED_ACCESS")&&(typeof e.simpleCriterion.values>"u"||Array.isArray(e.simpleCriterion.values)&&e.simpleCriterion.values.every(n=>typeof n=="string")))&&(typeof e.tagCriterion>"u"||(e.tagCriterion!==null&&typeof e.tagCriterion=="object"||typeof e.tagCriterion=="function")&&(typeof e.tagCriterion.comparator>"u"||e.tagCriterion.comparator==="CONTAINS"||e.tagCriterion.comparator==="EQ"||e.tagCriterion.comparator==="GT"||e.tagCriterion.comparator==="GTE"||e.tagCriterion.comparator==="LT"||e.tagCriterion.comparator==="LTE"||e.tagCriterion.comparator==="NE"||e.tagCriterion.comparator==="STARTS_WITH")&&(typeof e.tagCriterion.tagValues>"u"||Array.isArray(e.tagCriterion.tagValues)&&e.tagCriterion.tagValues.every(n=>(n!==null&&typeof n=="object"||typeof n=="function")&&(typeof n.key>"u"||typeof n.key=="string")&&(typeof n.value>"u"||typeof n.value=="string")))))))&&(typeof t.s3JobDefinition.bucketCriteria.includes>"u"||(t.s3JobDefinition.bucketCriteria.includes!==null&&typeof t.s3JobDefinition.bucketCriteria.includes=="object"||typeof t.s3JobDefinition.bucketCriteria.includes=="function")&&(typeof t.s3JobDefinition.bucketCriteria.includes.and>"u"||Array.isArray(t.s3JobDefinition.bucketCriteria.includes.and)&&t.s3JobDefinition.bucketCriteria.includes.and.every(e=>(e!==null&&typeof e=="object"||typeof e=="function")&&(typeof e.simpleCriterion>"u"||(e.simpleCriterion!==null&&typeof e.simpleCriterion=="object"||typeof e.simpleCriterion=="function")&&(typeof e.simpleCriterion.comparator>"u"||e.simpleCriterion.comparator==="CONTAINS"||e.simpleCriterion.comparator==="EQ"||e.simpleCriterion.comparator==="GT"||e.simpleCriterion.comparator==="GTE"||e.simpleCriterion.comparator==="LT"||e.simpleCriterion.comparator==="LTE"||e.simpleCriterion.comparator==="NE"||e.simpleCriterion.comparator==="STARTS_WITH")&&(typeof e.simpleCriterion.key>"u"||e.simpleCriterion.key==="ACCOUNT_ID"||e.simpleCriterion.key==="S3_BUCKET_EFFECTIVE_PERMISSION"||e.simpleCriterion.key==="S3_BUCKET_NAME"||e.simpleCriterion.key==="S3_BUCKET_SHARED_ACCESS")&&(typeof e.simpleCriterion.values>"u"||Array.isArray(e.simpleCriterion.values)&&e.simpleCriterion.values.every(n=>typeof n=="string")))&&(typeof e.tagCriterion>"u"||(e.tagCriterion!==null&&typeof e.tagCriterion=="object"||typeof e.tagCriterion=="function")&&(typeof e.tagCriterion.comparator>"u"||e.tagCriterion.comparator==="CONTAINS"||e.tagCriterion.comparator==="EQ"||e.tagCriterion.comparator==="GT"||e.tagCriterion.comparator==="GTE"||e.tagCriterion.comparator==="LT"||e.tagCriterion.comparator==="LTE"||e.tagCriterion.comparator==="NE"||e.tagCriterion.comparator==="STARTS_WITH")&&(typeof e.tagCriterion.tagValues>"u"||Array.isArray(e.tagCriterion.tagValues)&&e.tagCriterion.tagValues.every(n=>(n!==null&&typeof n=="object"||typeof n=="function")&&(typeof n.key>"u"||typeof n.key=="string")&&(typeof n.value>"u"||typeof n.value=="string"))))))))&&(typeof t.s3JobDefinition.bucketDefinitions>"u"||Array.isArray(t.s3JobDefinition.bucketDefinitions)&&t.s3JobDefinition.bucketDefinitions.every(e=>(e!==null&&typeof e=="object"||typeof e=="function")&&(typeof e.accountId>"u"||typeof e.accountId=="string")&&(typeof e.buckets>"u"||Array.isArray(e.buckets)&&e.buckets.every(n=>typeof n=="string"))))&&(typeof t.s3JobDefinition.scoping>"u"||(t.s3JobDefinition.scoping!==null&&typeof t.s3JobDefinition.scoping=="object"||typeof t.s3JobDefinition.scoping=="function")&&(typeof t.s3JobDefinition.scoping.excludes>"u"||(t.s3JobDefinition.scoping.excludes!==null&&typeof t.s3JobDefinition.scoping.excludes=="object"||typeof t.s3JobDefinition.scoping.excludes=="function")&&(typeof t.s3JobDefinition.scoping.excludes.and>"u"||Array.isArray(t.s3JobDefinition.scoping.excludes.and)&&t.s3JobDefinition.scoping.excludes.and.every(e=>(e!==null&&typeof e=="object"||typeof e=="function")&&(typeof e.simpleScopeTerm>"u"||(e.simpleScopeTerm!==null&&typeof e.simpleScopeTerm=="object"||typeof e.simpleScopeTerm=="function")&&(typeof e.simpleScopeTerm.comparator>"u"||e.simpleScopeTerm.comparator==="CONTAINS"||e.simpleScopeTerm.comparator==="EQ"||e.simpleScopeTerm.comparator==="GT"||e.simpleScopeTerm.comparator==="GTE"||e.simpleScopeTerm.comparator==="LT"||e.simpleScopeTerm.comparator==="LTE"||e.simpleScopeTerm.comparator==="NE"||e.simpleScopeTerm.comparator==="STARTS_WITH")&&(typeof e.simpleScopeTerm.key>"u"||e.simpleScopeTerm.key==="OBJECT_EXTENSION"||e.simpleScopeTerm.key==="OBJECT_KEY"||e.simpleScopeTerm.key==="OBJECT_LAST_MODIFIED_DATE"||e.simpleScopeTerm.key==="OBJECT_SIZE")&&(typeof e.simpleScopeTerm.values>"u"||Array.isArray(e.simpleScopeTerm.values)&&e.simpleScopeTerm.values.every(n=>typeof n=="string")))&&(typeof e.tagScopeTerm>"u"||(e.tagScopeTerm!==null&&typeof e.tagScopeTerm=="object"||typeof e.tagScopeTerm=="function")&&(typeof e.tagScopeTerm.comparator>"u"||e.tagScopeTerm.comparator==="CONTAINS"||e.tagScopeTerm.comparator==="EQ"||e.tagScopeTerm.comparator==="GT"||e.tagScopeTerm.comparator==="GTE"||e.tagScopeTerm.comparator==="LT"||e.tagScopeTerm.comparator==="LTE"||e.tagScopeTerm.comparator==="NE"||e.tagScopeTerm.comparator==="STARTS_WITH")&&(typeof e.tagScopeTerm.key>"u"||typeof e.tagScopeTerm.key=="string")&&(typeof e.tagScopeTerm.tagValues>"u"||Array.isArray(e.tagScopeTerm.tagValues)&&e.tagScopeTerm.tagValues.every(n=>(n!==null&&typeof n=="object"||typeof n=="function")&&(typeof n.key>"u"||typeof n.key=="string")&&(typeof n.value>"u"||typeof n.value=="string")))&&(typeof e.tagScopeTerm.target>"u"||e.tagScopeTerm.target==="S3_OBJECT")))))&&(typeof t.s3JobDefinition.scoping.includes>"u"||(t.s3JobDefinition.scoping.includes!==null&&typeof t.s3JobDefinition.scoping.includes=="object"||typeof t.s3JobDefinition.scoping.includes=="function")&&(typeof t.s3JobDefinition.scoping.includes.and>"u"||Array.isArray(t.s3JobDefinition.scoping.includes.and)&&t.s3JobDefinition.scoping.includes.and.every(e=>(e!==null&&typeof e=="object"||typeof e=="function")&&(typeof e.simpleScopeTerm>"u"||(e.simpleScopeTerm!==null&&typeof e.simpleScopeTerm=="object"||typeof e.simpleScopeTerm=="function")&&(typeof e.simpleScopeTerm.comparator>"u"||e.simpleScopeTerm.comparator==="CONTAINS"||e.simpleScopeTerm.comparator==="EQ"||e.simpleScopeTerm.comparator==="GT"||e.simpleScopeTerm.comparator==="GTE"||e.simpleScopeTerm.comparator==="LT"||e.simpleScopeTerm.comparator==="LTE"||e.simpleScopeTerm.comparator==="NE"||e.simpleScopeTerm.comparator==="STARTS_WITH")&&(typeof e.simpleScopeTerm.key>"u"||e.simpleScopeTerm.key==="OBJECT_EXTENSION"||e.simpleScopeTerm.key==="OBJECT_KEY"||e.simpleScopeTerm.key==="OBJECT_LAST_MODIFIED_DATE"||e.simpleScopeTerm.key==="OBJECT_SIZE")&&(typeof e.simpleScopeTerm.values>"u"||Array.isArray(e.simpleScopeTerm.values)&&e.simpleScopeTerm.values.every(n=>typeof n=="string")))&&(typeof e.tagScopeTerm>"u"||(e.tagScopeTerm!==null&&typeof e.tagScopeTerm=="object"||typeof e.tagScopeTerm=="function")&&(typeof e.tagScopeTerm.comparator>"u"||e.tagScopeTerm.comparator==="CONTAINS"||e.tagScopeTerm.comparator==="EQ"||e.tagScopeTerm.comparator==="GT"||e.tagScopeTerm.comparator==="GTE"||e.tagScopeTerm.comparator==="LT"||e.tagScopeTerm.comparator==="LTE"||e.tagScopeTerm.comparator==="NE"||e.tagScopeTerm.comparator==="STARTS_WITH")&&(typeof e.tagScopeTerm.key>"u"||typeof e.tagScopeTerm.key=="string")&&(typeof e.tagScopeTerm.tagValues>"u"||Array.isArray(e.tagScopeTerm.tagValues)&&e.tagScopeTerm.tagValues.every(n=>(n!==null&&typeof n=="object"||typeof n=="function")&&(typeof n.key>"u"||typeof n.key=="string")&&(typeof n.value>"u"||typeof n.value=="string")))&&(typeof e.tagScopeTerm.target>"u"||e.tagScopeTerm.target==="S3_OBJECT")))))))&&(typeof t.samplingPercentage>"u"||typeof t.samplingPercentage=="number")&&(typeof t.scheduleFrequency>"u"||(t.scheduleFrequency!==null&&typeof t.scheduleFrequency=="object"||typeof t.scheduleFrequency=="function")&&(typeof t.scheduleFrequency.dailySchedule>"u"||t.scheduleFrequency.dailySchedule!==null&&typeof t.scheduleFrequency.dailySchedule=="object"||typeof t.scheduleFrequency.dailySchedule=="function")&&(typeof t.scheduleFrequency.monthlySchedule>"u"||(t.scheduleFrequency.monthlySchedule!==null&&typeof t.scheduleFrequency.monthlySchedule=="object"||typeof t.scheduleFrequency.monthlySchedule=="function")&&(typeof t.scheduleFrequency.monthlySchedule.dayOfMonth>"u"||typeof t.scheduleFrequency.monthlySchedule.dayOfMonth=="number"))&&(typeof t.scheduleFrequency.weeklySchedule>"u"||(t.scheduleFrequency.weeklySchedule!==null&&typeof t.scheduleFrequency.weeklySchedule=="object"||typeof t.scheduleFrequency.weeklySchedule=="function")&&(typeof t.scheduleFrequency.weeklySchedule.dayOfWeek>"u"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="FRIDAY"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="MONDAY"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="SATURDAY"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="SUNDAY"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="THURSDAY"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="TUESDAY"||t.scheduleFrequency.weeklySchedule.dayOfWeek==="WEDNESDAY")))&&(typeof t.tags>"u"||(t.tags!==null&&typeof t.tags=="object"||typeof t.tags=="function")&&Object.entries(t.tags).every(([e,n])=>typeof n=="string"&&typeof e=="string"))}a(h,"isMacieJobRequest");var m=class{static{a(this,"Logger")}context;constructor(t){this.context=t}info(t,e){let n={level:"INFO",timestamp:new Date().toISOString(),requestId:this.context.requestId,functionName:this.context.functionName,functionVersion:this.context.functionVersion,message:t,data:e?this.sanitizeData(e):void 0};console.log(JSON.stringify(n))}error(t,e,n){let i={level:"ERROR",timestamp:new Date().toISOString(),requestId:this.context.requestId,functionName:this.context.functionName,functionVersion:this.context.functionVersion,message:t,error:e?{name:e.name,message:e.message,stack:e.stack,...e}:void 0,data:n?this.sanitizeData(n):void 0};console.error(JSON.stringify(i))}debug(t,e){let n={level:"DEBUG",timestamp:new Date().toISOString(),requestId:this.context.requestId,functionName:this.context.functionName,functionVersion:this.context.functionVersion,message:t,data:e?this.sanitizeData(e):void 0};console.log(JSON.stringify(n))}logApiRequest(t,e,n){this.info(`${t} API Request: ${e}`,{service:t,operation:e,parameters:this.sanitizeData(n)})}logApiResponse(t,e,n,i){this.info(`${t} API Response: ${e}`,{service:t,operation:e,duration:i?`${i}ms`:void 0,response:this.sanitizeData(n)})}logTiming(t,e){let n=Date.now()-e;this.info(`Operation completed: ${t}`,{operation:t,duration:`${n}ms`})}sanitizeData(t){if(!t)return t;let e=JSON.parse(JSON.stringify(t)),n=["password","secret","token","key","authorization","auth","credential","clientToken"];return this.maskSensitiveFields(e,n)}maskSensitiveFields(t,e){if(typeof t!="object"||t===null)return t;if(Array.isArray(t))return t.map(i=>this.maskSensitiveFields(i,e));let n={};for(let[i,r]of Object.entries(t)){let f=i.toLowerCase();e.some(p=>f.includes(p.toLowerCase()))&&typeof r=="string"?n[i]="***MASKED***":typeof r=="object"?n[i]=this.maskSensitiveFields(r,e):n[i]=r}return n}};var g=class{static{a(this,"ErrorHandler")}logger;context;constructor(t,e){this.logger=t,this.context=e}handleValidationError(t,e){return this.logger.error("Validation Error",void 0,{receivedData:e}),{success:!1,error:{type:"ValidationError",message:t,details:"The provided input does not conform to the expected schema",requestId:this.context.awsRequestId}}}handleAwsApiError(t,e,n){return this.logger.error(`${e} API Error`,t,{service:e,operation:n,errorCode:t.name,statusCode:t.$metadata?.httpStatusCode,awsRequestId:t.$metadata?.requestId}),{success:!1,error:{type:t.name||`${e}ApiError`,message:t.message||`Failed to execute ${e} ${n}`,details:{errorCode:t.name,statusCode:t.$metadata?.httpStatusCode,awsRequestId:t.$metadata?.requestId},requestId:this.context.awsRequestId}}}handleUnexpectedError(t){return this.logger.error("Unexpected Error",t),{success:!1,error:{type:"UnexpectedError",message:t.message||"An unexpected error occurred",details:{name:t.name,stack:t.stack},requestId:this.context.awsRequestId}}}handleCustomError(t,e,n){return this.logger.error(`Custom Error: ${t}`,void 0,{details:n}),{success:!1,error:{type:t,message:e,details:n,requestId:this.context.awsRequestId}}}handleEventBridgeValidationError(t,e,n){return this.logger.error("EventBridge Validation Error",void 0,{eventBusArn:e,validationError:n}),{success:!1,error:{type:"EventBridgeValidationError",message:t,details:{eventBusArn:e,validationError:n,requiredTagKey:"JobStatusEventBusArn",expectedArnFormat:"arn:aws:events:region:account:event-bus/name"},requestId:this.context.awsRequestId}}}handleError(t,e){return t.$metadata?this.handleAwsApiError(t,e?.service||"AWS",e?.operation||"Unknown"):t.type&&t.message?this.handleCustomError(t.type,t.message,t.details):this.handleUnexpectedError(t)}};var b=require("@aws-sdk/client-eventbridge");var S=class{static{a(this,"EventBridgeValidator")}client;logger;constructor(t,e){this.logger=t,this.client=new b.EventBridgeClient({region:e||process.env.AWS_REGION||"us-east-1"})}validateEventBusArnFormat(t){return/^arn:aws:events:[a-z0-9-]+:\d{12}:event-bus\/[a-zA-Z0-9._-]+$/.test(t)}extractEventBusNameFromArn(t){let e=t.match(/^arn:aws:events:[a-z0-9-]+:\d{12}:event-bus\/(.+)$/);return e?e[1]:null}async validateEventBusExists(t){try{this.logger.info("Validating EventBus existence",{eventBusName:t});let e=new b.DescribeEventBusCommand({Name:t}),n=await this.client.send(e);return n.Name?(this.logger.info("EventBus validation successful",{eventBusName:n.Name,eventBusArn:n.Arn}),{isValid:!0,eventBusName:n.Name}):{isValid:!1,error:"EventBus response missing name"}}catch(e){return this.logger.error("EventBus validation failed",e,{eventBusName:t}),{isValid:!1,error:e.message||"Failed to validate EventBus"}}}findEventBusArnTag(t){if(!t)return null;let e="jobstatuseventbusarn";for(let[n,i]of Object.entries(t))if(n.toLowerCase()===e)return i;return null}async validateEventBusArn(t){if(!this.validateEventBusArnFormat(t))return{isValid:!1,error:"Invalid EventBridge ARN format. Expected: arn:aws:events:region:account:event-bus/name"};let e=this.extractEventBusNameFromArn(t);return e?await this.validateEventBusExists(e):{isValid:!1,error:"Could not extract EventBus name from ARN"}}};function l(o){return o&&typeof o=="object"&&"httpMethod"in o&&"headers"in o}a(l,"isAPIGatewayEvent");function T(o,t,e){return{statusCode:o,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, X-Amz-Date, Authorization, X-Api-Key, X-Amz-Security-Token"},body:JSON.stringify({success:!1,error:{type:"ValidationError",message:t,requestId:e}})}}a(T,"createAPIGatewayErrorResponse");function j(o){return{statusCode:200,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, X-Amz-Date, Authorization, X-Api-Key, X-Amz-Security-Token"},body:JSON.stringify(o)}}a(j,"createAPIGatewaySuccessResponse");var x=a(async(o,t)=>{let e=Date.now(),n=new m({requestId:t.awsRequestId,functionName:t.functionName,functionVersion:t.functionVersion}),i=new g(n,t);n.info("Lambda function started",{functionName:t.functionName,functionVersion:t.functionVersion,remainingTimeInMillis:t.getRemainingTimeInMillis(),eventType:l(o)?"APIGatewayProxyEvent":"DirectInvocation"});try{n.info("Parsing input event");let r;if(l(o)){if(n.info("Processing API Gateway proxy event"),!o.body)return T(400,"API Gateway event missing body",t.awsRequestId);try{r=JSON.parse(o.body),n.info("Successfully parsed API Gateway request body")}catch(s){let d="Invalid JSON in request body";return n.error("JSON parse error",s),T(400,d,t.awsRequestId)}}else n.info("Processing direct Lambda invocation"),r=o;if(n.info("Validating MacieJobRequest schema"),!h(r)){let s="Invalid input: Event does not match MacieJobRequest schema";return l(o)?T(400,s,t.awsRequestId):i.handleValidationError(s,r)}n.info("Input validation successful",{jobType:r.jobType,jobName:r.name,hasS3JobDefinition:!!r.s3JobDefinition,hasBucketDefinitions:!!r.s3JobDefinition?.bucketDefinitions,bucketDefinitionsCount:r.s3JobDefinition?.bucketDefinitions?.length||0}),n.info("Validating required JobStatusEventBusArn tag");let f=new S(n),u=f.findEventBusArnTag(r.tags);if(!u){let s='Required tag "JobStatusEventBusArn" is missing',d=r.tags?Object.keys(r.tags):[],J=i.handleEventBridgeValidationError(s,void 0,`Missing required tag. Provided tags: ${d.join(", ")}`);return l(o)?T(400,s,t.awsRequestId):J}n.info("Found JobStatusEventBusArn tag",{eventBusArn:u});let p=await f.validateEventBusArn(u);if(!p.isValid)return i.handleEventBridgeValidationError("Invalid or non-existent EventBus ARN in JobStatusEventBusArn tag",u,p.error);n.info("EventBridge validation successful",{eventBusArn:u,eventBusName:p.eventBusName}),n.info("Initializing Macie client");let I=new C.Macie2Client({region:process.env.AWS_REGION||"us-east-1"});n.info("Preparing CreateClassificationJob command");let v=new C.CreateClassificationJobCommand(r);n.logApiRequest("Macie2","CreateClassificationJob",r),n.info("Executing CreateClassificationJob API call");let E=Date.now(),c;try{c=await I.send(v)}catch(s){let d=Date.now()-E;return n.error("Macie API call failed",s,{apiDuration:`${d}ms`}),i.handleAwsApiError(s,"Macie2","CreateClassificationJob")}let D=Date.now()-E;if(n.logApiResponse("Macie2","CreateClassificationJob",c,D),!c.jobId||!c.jobArn)return i.handleCustomError("InvalidApiResponse","Invalid response from Macie API: Missing jobId or jobArn",c);let A={success:!0,data:{jobId:c.jobId,jobArn:c.jobArn,requestId:t.awsRequestId}};return n.info("Macie Classification Job created successfully",{jobId:c.jobId,jobArn:c.jobArn,jobName:r.name,jobType:r.jobType}),n.logTiming("CreateMacieJob Lambda execution",e),l(o)?j(A):A}catch(r){return i.handleUnexpectedError(r)}},"handler");0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
